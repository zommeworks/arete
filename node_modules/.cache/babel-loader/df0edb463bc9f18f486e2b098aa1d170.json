{"ast":null,"code":"var _jsxFileName = \"/Users/zomme/Github/arete/src/App.js\";\nimport React from 'react';\nimport Sound from 'react-sound'; //to install: npm install react-sound\n\nimport styles from './App.css';\nimport data from './testscript.json';\nimport $ from 'jquery';\n/*\n  UI scheme\n\n ┏━━━━ baseplate ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓\n ┃                                                 ┃\n ┃  ┏━━━━ TTSComp ━━━━━━━━━━━━━━━━━━━━━━━┓         ┃\n ┃  ┃  state: url (string)               ┃         ┃\n ┃  ┃         name (string)              ┃         ┃\n ┃  ┃         maxTimeout (int)           ┃         ┃\n ┃  ┃         voiceInput (0/1)           ┃         ┃\n ┃  ┃         playStatus (Sound.Status)  ┃         ┃\n ┃  ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛         ┃\n ┃                                                 ┃\n ┃  ┏━━━━ BoxAgent ━━━━━━━━━━━━━━━━━━━━━━━━━━┓     ┃\n ┃  ┃  ┏━━━━ ButtonAgent ━━━━━━━━━━━━━━━━━┓  ┃     ┃\n ┃  ┃  ┃  state: voiceInput (0/1)         ┃  ┃     ┃\n ┃  ┃  ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛  ┃     ┃\n ┃  ┃  ┏━━━━ TextSubtitle ━━━━━━━━━━━━━━━━┓  ┃     ┃\n ┃  ┃  ┃  state: theme (light / dark)     ┃  ┃     ┃\n ┃  ┃  ┃         displayMessage (string)  ┃  ┃     ┃\n ┃  ┃  ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛  ┃     ┃\n ┃  ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛     ┃\n ┃                                                 ┃\n ┃  ┏━━━━ BoxImage ━━━━━━━━━━━━━━━━━━━━━━━━━━┓     ┃\n ┃  ┃  (props:hasImage)                      ┃     ┃\n ┃  ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛     ┃\n ┃                                                 ┃\n ┃  ┏━━━━ BoxController ━━━━━━━━━━━━━━━━━━━━━━━━┓  ┃\n ┃  ┃  state: theme (light / dark)              ┃  ┃\n ┃  ┃         voiceInput (0/1)                  ┃  ┃\n ┃  ┃  ┏━━━━ div.box-bar ━━━━━━━━━━━━━━━━━━━━┓  ┃  ┃\n ┃  ┃  ┃  ┏━━━━ ProgressBar ━━━━━━━━━━━━━━┓  ┃  ┃  ┃\n ┃  ┃  ┃  ┃  state: voiceInput (0/1)      ┃  ┃  ┃  ┃\n ┃  ┃  ┃  ┃         maxTimeout (int)      ┃  ┃  ┃  ┃\n ┃  ┃  ┃  ┃         elapsedTime (int)     ┃  ┃  ┃  ┃\n ┃  ┃  ┃  ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛  ┃  ┃  ┃\n ┃  ┃  ┃  ┏━━━━ div.bar-base ━━━━━━━━━━━━━┓  ┃  ┃  ┃\n ┃  ┃  ┃  ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛  ┃  ┃  ┃\n ┃  ┃  ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛  ┃  ┃\n ┃  ┃  ┏━━━━ div.box-buttons ━━━━━━━━━━━━━━━━┓  ┃  ┃\n ┃  ┃  ┃  ┏━━━━ BtnSmall #btnRewind ━━━━━━┓  ┃  ┃  ┃\n ┃  ┃  ┃  ┃  state: theme (light / dark)  ┃  ┃  ┃  ┃\n ┃  ┃  ┃  ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛  ┃  ┃  ┃\n ┃  ┃  ┃  ┏━━━━ BtnSmall #btnPlayPause ━━━┓  ┃  ┃  ┃\n ┃  ┃  ┃  ┃  state: theme (light / dark)  ┃  ┃  ┃  ┃\n ┃  ┃  ┃  ┃         voiceInput (0/1)      ┃  ┃  ┃  ┃\n ┃  ┃  ┃  ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛  ┃  ┃  ┃\n ┃  ┃  ┃  ┏━━━━ BtnSmall #btnSkip ━━━━━━━━┓  ┃  ┃  ┃\n ┃  ┃  ┃  ┃  state: theme (light / dark)  ┃  ┃  ┃  ┃\n ┃  ┃  ┃  ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛  ┃  ┃  ┃\n ┃  ┃  ┃  ┏━━━━ BtnSmall #btnExit ━━━━━━━━┓  ┃  ┃  ┃\n ┃  ┃  ┃  ┃  state: theme (light / dark)  ┃  ┃  ┃  ┃\n ┃  ┃  ┃  ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛  ┃  ┃  ┃\n ┃  ┃  ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛  ┃  ┃\n ┃  ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛  ┃\n ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛\n\n**/\n\n/* * * * * * * * * * *\n * global variables  *\n * * * * * * * * * * */\n\nvar currentData = {};\nvar nextDataName = ''; //functions\n\nfunction initData() {\n  try {\n    let docID = getUrlParams().name;\n    $.each(data.list, function (i) {\n      if (data.list[i].name === docID) {\n        overwriteData(data.list[i], currentData);\n      }\n    });\n  } catch (e) {\n    alert('failed to load data');\n  }\n\n  nextDataName = getnextDataName();\n}\n\nfunction initNext() {\n  $.each(data.list, function (i) {\n    if (data.list[i].name === nextDataName) {\n      overwriteData(data.list[i], currentData);\n    }\n  });\n  nextDataName = getnextDataName();\n}\n\nfunction getnextDataName() {\n  let j;\n\n  for (let i = 0; i < data.list.length; i++) {\n    if (data.list[i].name === currentData.name) {\n      j = i + 1;\n      break;\n    }\n  }\n\n  for (j; j < data.list.length; j++) {\n    if (data.list[j].name.match(/(prompt|statement)/)) {\n      return data.list[j].name;\n      break;\n    }\n  }\n}\n\nfunction getUrlParams() {\n  var params = {};\n  window.location.search.replace(/[?&]+([^=&]+)=([^&]*)/gi, function (str, key, value) {\n    params[key] = value;\n  });\n  return params;\n}\n\nfunction overwriteData(source, target) {\n  target.name = source.name;\n  target.message = source.message;\n  target.displayMessage = source.displayMessage;\n  target.displayOnly = source.displayOnly;\n  target.hasImage = source.hasImage;\n  target.epd = source.epd;\n  target.answerEntity = source.answerEntity;\n  target.maxTimeout = source.maxTimeout;\n}\n\n$(\"img\").error(function () {\n  $(this).unbind(\"error\").attr(\"src\", \"../src/none.png\");\n});\n\nclass Baseplate extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      name: '',\n      message: '',\n      displayMessage: '',\n      displayOnly: 0,\n      hasImage: 0,\n      epd: 0,\n      answerEntity: '',\n      maxTimeout: 0,\n      voiceInput: 0,\n      elapsedTime: 0,\n      theme: 'light',\n      playStatus: Sound.status.STOPPED\n    };\n    this.voiceInputHandler = this.voiceInputHandler.bind(this);\n    this.updateState = this.updateState.bind(this);\n    this.playSound = this.playSound.bind(this);\n  }\n\n  static getDerivedStateFromProps(props, state) {\n    return {\n      name: props.name,\n      message: props.message,\n      displayMessage: props.displayMessage,\n      displayOnly: props.displayOnly,\n      hasImage: props.hasImage,\n      epd: props.epd,\n      answerEntity: props.answerEntity,\n      maxTimeout: props.maxTimeout\n    };\n  }\n\n  updateState() {\n    window.location.href = '?name=' + nextDataName; //\n\n    initNext();\n    this.setState({\n      name: currentData.name,\n      message: currentData.message,\n      displayMessage: currentData.displayMessage,\n      displayOnly: currentData.displayOnly,\n      hasImage: currentData.hasImage,\n      epd: currentData.epd,\n      answerEntity: currentData.answerEntity,\n      maxTimeout: currentData.maxTimeout,\n      voiceInput: 0,\n      elapsedTime: 0,\n      playStatus: Sound.status.STOPPED\n    });\n    console.log('redirected to next script: ' + window.location);\n  }\n\n  stopAndSkip() {\n    this.setState({\n      theme: 'light',\n      voiceInput: 0\n    });\n    setTimeout(() => {\n      clearInterval(this.timeoutCounter);\n      this.updateState();\n    }, 500); //\n  }\n\n  playSound() {\n    this.setState({\n      playStatus: Sound.status.PLAYING\n    });\n  }\n\n  voiceInputHandler() {\n    //getting user turn\n    if (currentData.name.match(/(prompt|feedback)/)) {\n      if (this.state.voiceInput === 0) {\n        this.setState({\n          theme: 'dark',\n          voiceInput: 1,\n          playStatus: Sound.status.STOPPED\n        }); //start timeout counter\n\n        const limit = this.state.maxTimeout * 1000;\n        const frequency = 100;\n        var elapsedTime = 0;\n        this.timeoutCounter = setInterval(() => {\n          if (elapsedTime < limit) {\n            elapsedTime += frequency;\n            this.setState({\n              elapsedTime: elapsedTime / 1000\n            });\n            console.log('listening: ', elapsedTime / 1000);\n          } else {\n            this.stopAndSkip();\n          }\n        }, frequency);\n      }\n    } //pass to next target\n    else if (currentData.name.match(/statement/)) {\n        this.updateState();\n      }\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      id: \"baseplate\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 239,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(TTSComp, {\n      name: this.state.name,\n      maxTimeout: this.state.maxTimeout,\n      voiceInput: this.state.voiceInput,\n      voiceInputHandler: this.voiceInputHandler,\n      playStatus: this.state.playStatus,\n      playSound: this.playSound,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 240,\n        columnNumber: 9\n      }\n    }), /*#__PURE__*/React.createElement(BoxAgent, {\n      voiceInput: this.state.voiceInput,\n      theme: this.state.theme,\n      displayMessage: this.state.displayMessage,\n      voiceInputHandler: this.voiceInputHandler,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 248,\n        columnNumber: 9\n      }\n    }), /*#__PURE__*/React.createElement(BoxImage, {\n      name: this.state.name,\n      hasImage: this.state.hasImage,\n      theme: this.state.theme,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 254,\n        columnNumber: 9\n      }\n    }), /*#__PURE__*/React.createElement(BoxController, {\n      theme: this.state.theme,\n      maxTimeout: this.state.maxTimeout,\n      voiceInput: this.state.voiceInput,\n      elapsedTime: this.state.elapsedTime,\n      voiceInputHandler: this.voiceInputHandler,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 259,\n        columnNumber: 9\n      }\n    }));\n  }\n\n}\n\nclass TTSComp extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      voiceInput: 0,\n      playStatus: Sound.status.STOPPED\n    };\n  }\n\n  static getDerivedStateFromProps(props, state) {\n    return {\n      url: 'tts/' + props.name + '.mp3',\n      name: props.name,\n      maxTimeout: props.maxTimeout,\n      voiceInput: props.voiceInput,\n      playStatus: props.playStatus\n    };\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(Sound, {\n      url: this.state.url,\n      autoLoad: true,\n      onLoad: this.props.playSound,\n      playStatus: this.state.playStatus,\n      onFinishedPlaying: this.props.voiceInputHandler,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 290,\n        columnNumber: 7\n      }\n    });\n  }\n\n}\n/* * * * * * * * * * * * *\n * BoxAgent and children *\n * * * * * * * * * * * * */\n\n\nclass BoxAgent extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      voiceInput: 0,\n      theme: 'light',\n      displayMessage: \"dummy text\"\n    };\n  }\n\n  static getDerivedStateFromProps(props, state) {\n    return {\n      voiceInput: props.voiceInput,\n      theme: props.theme,\n      displayMessage: props.displayMessage\n    };\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"box-agent\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 325,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(ButtonAgent, {\n      voiceInput: this.state.voiceInput,\n      voiceInputHandler: this.props.voiceInputHandler,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 326,\n        columnNumber: 9\n      }\n    }), /*#__PURE__*/React.createElement(TextSubtitle, {\n      theme: this.state.theme,\n      displayMessage: this.state.displayMessage,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 330,\n        columnNumber: 9\n      }\n    }));\n  }\n\n}\n\nclass ButtonAgent extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.setButtonStatus = param => {\n      switch (param) {\n        case 0:\n          return 'idle';\n\n        case 1:\n          return 'listening';\n\n        default:\n          return 'idle';\n      }\n    };\n\n    this.state = {\n      voiceInput: 0\n    };\n  }\n\n  static getDerivedStateFromProps(props, state) {\n    return {\n      voiceInput: props.voiceInput\n    };\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(\"button\", {\n      id: \"btnAgent\",\n      className: \"button-agent status-\" + this.setButtonStatus(this.state.voiceInput),\n      onClick: this.props.voiceInputHandler,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 360,\n        columnNumber: 7\n      }\n    });\n  }\n\n}\n\nclass TextSubtitle extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      theme: 'light',\n      displayMessage: 'dummy text'\n    };\n  }\n\n  static getDerivedStateFromProps(props, state) {\n    return {\n      theme: props.theme,\n      displayMessage: props.displayMessage\n    };\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(\"p\", {\n      id: \"txtSubtitle\",\n      className: \"theme-\" + this.state.theme,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 386,\n        columnNumber: 7\n      }\n    }, this.state.displayMessage);\n  }\n\n}\n/* * * * * * * * * * * * * * * *\n * Image If needed  *\n * * * * * * * * * * * * * * * */\n\n\nclass BoxImage extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      theme: 'light'\n    };\n  }\n\n  static getDerivedStateFromProps(props, state) {\n    return {\n      theme: props.theme\n    };\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: 'box-image',\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 417,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"img\", {\n      className: 'image theme-' + this.state.theme,\n      src: './img/' + this.props.name + '.png' //src={'./img/TASK_J2_03_prompt_1.png'}\n      ,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 418,\n        columnNumber: 9\n      }\n    }));\n  }\n\n}\n/* * * * * * * * * * * * * * * *\n * BoxController and children  *\n * * * * * * * * * * * * * * * */\n\n\nclass BoxController extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.setTheme = () => {\n      this.setState({\n        theme: this.state.theme === 'light' ? 'dark' : 'light'\n      });\n    };\n\n    this.state = {\n      theme: 'light'\n    };\n  }\n\n  static getDerivedStateFromProps(props, state) {\n    return {\n      theme: props.theme\n    };\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"box-controller\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 451,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"box-bar\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 452,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(ProgressBar, {\n      voiceInput: this.state.voiceInput,\n      elapsedTime: this.props.elapsedTime,\n      maxTimeout: this.props.maxTimeout,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 453,\n        columnNumber: 11\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"bar bar-base theme-\" + this.state.theme,\n      onClick: this.setTheme,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 458,\n        columnNumber: 11\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"box-buttons\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 461,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(ButtonSmall, {\n      name: \"btnRewind\",\n      alignRight: false,\n      theme: this.state.theme,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 462,\n        columnNumber: 11\n      }\n    }), /*#__PURE__*/React.createElement(ButtonSmall, {\n      name: \"btnSkip\",\n      alignRight: false,\n      theme: this.state.theme,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 467,\n        columnNumber: 11\n      }\n    }), /*#__PURE__*/React.createElement(ButtonSmall, {\n      name: \"btnExit\",\n      alignRight: true,\n      theme: this.state.theme,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 468,\n        columnNumber: 11\n      }\n    })));\n  }\n\n}\n\nclass ProgressBar extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.getWidth = () => {\n      let limit = this.props.maxTimeout;\n      let percentage = this.state.elapsedTime / limit * 100 + '%';\n      return percentage;\n    };\n\n    this.state = {\n      voiceInput: 0\n    };\n  }\n\n  static getDerivedStateFromProps(props, state) {\n    return {\n      voiceInput: props.voiceInput,\n      elapsedTime: props.elapsedTime\n    };\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"bar bar-progress\",\n      style: {\n        width: this.getWidth()\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 494,\n        columnNumber: 7\n      }\n    });\n  }\n\n}\n\nclass ButtonSmall extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      theme: 'light',\n      clicked: false\n    };\n  }\n\n  static getDerivedStateFromProps(props, state) {\n    return {\n      theme: props.theme,\n      clicked: props.clicked\n    };\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(\"button\", {\n      id: this.props.name,\n      className: \"button-small theme-\" + this.state.theme + (this.props.alignRight ? ' align-right' : ''),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 517,\n        columnNumber: 7\n      }\n    });\n  }\n\n}\n\nfunction App() {\n  initData();\n  const element = /*#__PURE__*/React.createElement(Baseplate, {\n    name: currentData.name,\n    message: currentData.message,\n    displayMessage: currentData.displayMessage,\n    displayOnly: currentData.displayOnly,\n    hasImage: currentData.hasImage,\n    epd: currentData.epd,\n    answerEntity: currentData.answerEntity,\n    maxTimeout: currentData.maxTimeout,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 534,\n      columnNumber: 5\n    }\n  });\n  return element;\n}\n\nexport default App;","map":{"version":3,"sources":["/Users/zomme/Github/arete/src/App.js"],"names":["React","Sound","styles","data","$","currentData","nextDataName","initData","docID","getUrlParams","name","each","list","i","overwriteData","e","alert","getnextDataName","initNext","j","length","match","params","window","location","search","replace","str","key","value","source","target","message","displayMessage","displayOnly","hasImage","epd","answerEntity","maxTimeout","error","unbind","attr","Baseplate","Component","constructor","props","state","voiceInput","elapsedTime","theme","playStatus","status","STOPPED","voiceInputHandler","bind","updateState","playSound","getDerivedStateFromProps","href","setState","console","log","stopAndSkip","setTimeout","clearInterval","timeoutCounter","PLAYING","limit","frequency","setInterval","render","TTSComp","url","BoxAgent","ButtonAgent","setButtonStatus","param","TextSubtitle","BoxImage","BoxController","setTheme","ProgressBar","getWidth","percentage","width","ButtonSmall","clicked","alignRight","App","element"],"mappings":"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","sourcesContent":["import React from 'react';\nimport Sound from 'react-sound'; //to install: npm install react-sound\nimport styles from './App.css';\nimport data from './testscript.json'\nimport $ from 'jquery';\n\n\n/*\n  UI scheme\n\n ┏━━━━ baseplate ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓\n ┃                                                 ┃\n ┃  ┏━━━━ TTSComp ━━━━━━━━━━━━━━━━━━━━━━━┓         ┃\n ┃  ┃  state: url (string)               ┃         ┃\n ┃  ┃         name (string)              ┃         ┃\n ┃  ┃         maxTimeout (int)           ┃         ┃\n ┃  ┃         voiceInput (0/1)           ┃         ┃\n ┃  ┃         playStatus (Sound.Status)  ┃         ┃\n ┃  ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛         ┃\n ┃                                                 ┃\n ┃  ┏━━━━ BoxAgent ━━━━━━━━━━━━━━━━━━━━━━━━━━┓     ┃\n ┃  ┃  ┏━━━━ ButtonAgent ━━━━━━━━━━━━━━━━━┓  ┃     ┃\n ┃  ┃  ┃  state: voiceInput (0/1)         ┃  ┃     ┃\n ┃  ┃  ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛  ┃     ┃\n ┃  ┃  ┏━━━━ TextSubtitle ━━━━━━━━━━━━━━━━┓  ┃     ┃\n ┃  ┃  ┃  state: theme (light / dark)     ┃  ┃     ┃\n ┃  ┃  ┃         displayMessage (string)  ┃  ┃     ┃\n ┃  ┃  ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛  ┃     ┃\n ┃  ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛     ┃\n ┃                                                 ┃\n ┃  ┏━━━━ BoxImage ━━━━━━━━━━━━━━━━━━━━━━━━━━┓     ┃\n ┃  ┃  (props:hasImage)                      ┃     ┃\n ┃  ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛     ┃\n ┃                                                 ┃\n ┃  ┏━━━━ BoxController ━━━━━━━━━━━━━━━━━━━━━━━━┓  ┃\n ┃  ┃  state: theme (light / dark)              ┃  ┃\n ┃  ┃         voiceInput (0/1)                  ┃  ┃\n ┃  ┃  ┏━━━━ div.box-bar ━━━━━━━━━━━━━━━━━━━━┓  ┃  ┃\n ┃  ┃  ┃  ┏━━━━ ProgressBar ━━━━━━━━━━━━━━┓  ┃  ┃  ┃\n ┃  ┃  ┃  ┃  state: voiceInput (0/1)      ┃  ┃  ┃  ┃\n ┃  ┃  ┃  ┃         maxTimeout (int)      ┃  ┃  ┃  ┃\n ┃  ┃  ┃  ┃         elapsedTime (int)     ┃  ┃  ┃  ┃\n ┃  ┃  ┃  ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛  ┃  ┃  ┃\n ┃  ┃  ┃  ┏━━━━ div.bar-base ━━━━━━━━━━━━━┓  ┃  ┃  ┃\n ┃  ┃  ┃  ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛  ┃  ┃  ┃\n ┃  ┃  ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛  ┃  ┃\n ┃  ┃  ┏━━━━ div.box-buttons ━━━━━━━━━━━━━━━━┓  ┃  ┃\n ┃  ┃  ┃  ┏━━━━ BtnSmall #btnRewind ━━━━━━┓  ┃  ┃  ┃\n ┃  ┃  ┃  ┃  state: theme (light / dark)  ┃  ┃  ┃  ┃\n ┃  ┃  ┃  ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛  ┃  ┃  ┃\n ┃  ┃  ┃  ┏━━━━ BtnSmall #btnPlayPause ━━━┓  ┃  ┃  ┃\n ┃  ┃  ┃  ┃  state: theme (light / dark)  ┃  ┃  ┃  ┃\n ┃  ┃  ┃  ┃         voiceInput (0/1)      ┃  ┃  ┃  ┃\n ┃  ┃  ┃  ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛  ┃  ┃  ┃\n ┃  ┃  ┃  ┏━━━━ BtnSmall #btnSkip ━━━━━━━━┓  ┃  ┃  ┃\n ┃  ┃  ┃  ┃  state: theme (light / dark)  ┃  ┃  ┃  ┃\n ┃  ┃  ┃  ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛  ┃  ┃  ┃\n ┃  ┃  ┃  ┏━━━━ BtnSmall #btnExit ━━━━━━━━┓  ┃  ┃  ┃\n ┃  ┃  ┃  ┃  state: theme (light / dark)  ┃  ┃  ┃  ┃\n ┃  ┃  ┃  ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛  ┃  ┃  ┃\n ┃  ┃  ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛  ┃  ┃\n ┃  ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛  ┃\n ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛\n\n**/\n\n\n\n/* * * * * * * * * * *\n * global variables  *\n * * * * * * * * * * */\n\nvar currentData = {};\nvar nextDataName = '';\n\n\n\n//functions\n\nfunction initData(){\n  try {\n    let docID = getUrlParams().name;\n    $.each(data.list, function(i){\n      if(data.list[i].name === docID){\n        overwriteData(data.list[i], currentData);\n      }\n    });\n  }\n  catch(e) {\n    alert('failed to load data');\n  }\n  nextDataName = getnextDataName();\n}\n\nfunction initNext() {\n  $.each(data.list, function(i){\n    if(data.list[i].name === nextDataName){\n      overwriteData(data.list[i], currentData);\n    }\n  });\n  nextDataName = getnextDataName();\n}\n\nfunction getnextDataName() {\n  let j;\n  for(let i = 0; i < data.list.length; i++){\n    if(data.list[i].name === currentData.name){\n      j = i+1;\n      break;\n    }\n  }\n  for(j; j < data.list.length; j++){\n    if(data.list[j].name.match(/(prompt|statement)/)) {\n      return data.list[j].name;\n      break;\n    }\n  }\n}\n\nfunction getUrlParams() {\n    var params = {};\n    window.location.search.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(str, key, value) { params[key] = value; });\n    return params;\n}\n\nfunction overwriteData(source, target) {\n  target.name = source.name;\n  target.message = source.message;\n  target.displayMessage = source.displayMessage;\n  target.displayOnly = source.displayOnly;\n  target.hasImage = source.hasImage;\n  target.epd = source.epd;\n  target.answerEntity = source.answerEntity;\n  target.maxTimeout = source.maxTimeout;\n}\n\n$(\"img\").error(function () {\n    $(this).unbind(\"error\").attr(\"src\", \"../src/none.png\");\n});\n\nclass Baseplate extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      name: '',\n      message: '',\n      displayMessage: '',\n      displayOnly: 0,\n      hasImage: 0,\n      epd: 0,\n      answerEntity: '',\n      maxTimeout: 0,\n      voiceInput: 0,\n      elapsedTime: 0,\n      theme: 'light',\n      playStatus: Sound.status.STOPPED\n    }\n    this.voiceInputHandler = this.voiceInputHandler.bind(this);\n    this.updateState = this.updateState.bind(this);\n    this.playSound = this.playSound.bind(this);\n  }\n  static getDerivedStateFromProps(props, state) {\n    return {\n      name: props.name,\n      message: props.message,\n      displayMessage: props.displayMessage,\n      displayOnly: props.displayOnly,\n      hasImage: props.hasImage,\n      epd: props.epd,\n      answerEntity: props.answerEntity,\n      maxTimeout: props.maxTimeout,\n    };\n  }\n  updateState() {\n    window.location.href = '?name=' + nextDataName;//\n    initNext();\n    this.setState({\n      name: currentData.name,\n      message: currentData.message,\n      displayMessage: currentData.displayMessage,\n      displayOnly: currentData.displayOnly,\n      hasImage: currentData.hasImage,\n      epd: currentData.epd,\n      answerEntity: currentData.answerEntity,\n      maxTimeout: currentData.maxTimeout,\n      voiceInput: 0,\n      elapsedTime: 0,\n      playStatus: Sound.status.STOPPED,\n    });\n    console.log('redirected to next script: '+window.location);\n  }\n  stopAndSkip() {\n    this.setState({\n      theme: 'light',\n      voiceInput: 0,\n    });\n    setTimeout(() => {\n      clearInterval(this.timeoutCounter);\n      this.updateState();\n    }, 500);//\n  }\n  playSound() {\n    this.setState({\n      playStatus: Sound.status.PLAYING\n    });\n  }\n  voiceInputHandler() {\n    //getting user turn\n    if(currentData.name.match(/(prompt|feedback)/)) {\n      if(this.state.voiceInput === 0) {\n        this.setState({\n          theme: 'dark',\n          voiceInput: 1,\n          playStatus: Sound.status.STOPPED\n        });\n        //start timeout counter\n        const limit = this.state.maxTimeout * 1000;\n        const frequency = 100;\n        var elapsedTime = 0;\n        this.timeoutCounter = setInterval(() => {\n          if(elapsedTime < limit) {\n            elapsedTime += frequency;\n            this.setState({ elapsedTime: elapsedTime/1000 });\n            console.log('listening: ',elapsedTime/1000);\n          }\n          else {\n            this.stopAndSkip();\n          }\n        }, frequency);\n      }\n    }\n    //pass to next target\n    else if(currentData.name.match(/statement/)) {\n      this.updateState();\n    }\n  }\n  render() {\n    return(\n      <div id=\"baseplate\">\n        <TTSComp\n          name={this.state.name}\n          maxTimeout={this.state.maxTimeout}\n          voiceInput={this.state.voiceInput}\n          voiceInputHandler={this.voiceInputHandler}\n          playStatus={this.state.playStatus}\n          playSound={this.playSound}\n        />\n        <BoxAgent\n          voiceInput={this.state.voiceInput}\n          theme={this.state.theme}\n          displayMessage={this.state.displayMessage}\n          voiceInputHandler={this.voiceInputHandler}\n        />\n        <BoxImage\n          name={this.state.name}\n          hasImage={this.state.hasImage}\n          theme={this.state.theme}\n        />\n        <BoxController\n          theme={this.state.theme}\n          maxTimeout={this.state.maxTimeout}\n          voiceInput={this.state.voiceInput}\n          elapsedTime={this.state.elapsedTime}\n          voiceInputHandler={this.voiceInputHandler}\n        />\n      </div>\n    );\n  }\n}\n\nclass TTSComp extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      voiceInput: 0,\n      playStatus: Sound.status.STOPPED,\n    }\n  }\n  static getDerivedStateFromProps(props, state) {\n    return {\n      url: 'tts/'+props.name+'.mp3',\n      name: props.name,\n      maxTimeout: props.maxTimeout,\n      voiceInput: props.voiceInput,\n      playStatus: props.playStatus,\n    };\n  }\n  render() {\n    return(\n      <Sound\n        url={this.state.url}\n        autoLoad={true}\n        onLoad={this.props.playSound}\n        playStatus={this.state.playStatus}\n        onFinishedPlaying={this.props.voiceInputHandler}\n      />\n    );\n  }\n}\n\n\n\n/* * * * * * * * * * * * *\n * BoxAgent and children *\n * * * * * * * * * * * * */\n\nclass BoxAgent extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      voiceInput: 0,\n      theme: 'light',\n      displayMessage: \"dummy text\"\n    };\n  }\n  static getDerivedStateFromProps(props, state) {\n    return {\n      voiceInput: props.voiceInput,\n      theme: props.theme,\n      displayMessage: props.displayMessage\n    };\n  }\n  render() {\n    return(\n      <div className=\"box-agent\">\n        <ButtonAgent\n          voiceInput={this.state.voiceInput}\n          voiceInputHandler={this.props.voiceInputHandler}\n        />\n        <TextSubtitle theme={this.state.theme} displayMessage={this.state.displayMessage}/>\n      </div>\n    );\n  }\n}\n\nclass ButtonAgent extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      voiceInput: 0,\n    };\n  }\n  static getDerivedStateFromProps(props, state) {\n    return {\n      voiceInput: props.voiceInput\n    };\n  }\n  setButtonStatus = (param) => {\n    switch(param) {\n      case 0:\n        return 'idle';\n      case 1:\n        return 'listening';\n      default:\n        return 'idle';\n    }\n  }\n  render() {\n    return(\n      <button\n        id=\"btnAgent\"\n        className={\"button-agent status-\"+this.setButtonStatus(this.state.voiceInput)}\n        onClick={this.props.voiceInputHandler}\n      >\n      </button>\n    );\n  }\n}\n\nclass TextSubtitle extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      theme: 'light',\n      displayMessage: 'dummy text'\n    };\n  }\n  static getDerivedStateFromProps(props, state) {\n    return {\n      theme: props.theme,\n      displayMessage: props.displayMessage\n    };\n  }\n  render() {\n    return(\n      <p\n        id=\"txtSubtitle\"\n        className={\"theme-\"+this.state.theme}\n      >\n        {this.state.displayMessage}\n      </p>\n    );\n  }\n}\n\n\n\n\n/* * * * * * * * * * * * * * * *\n * Image If needed  *\n * * * * * * * * * * * * * * * */\n\nclass BoxImage extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      theme: 'light'\n    }\n  }\n  static getDerivedStateFromProps(props, state) {\n    return {\n      theme: props.theme,\n    };\n  }\n  render() {\n    return(\n      <div className={'box-image'}>\n        <img\n          className={'image theme-'+this.state.theme}\n          src={'./img/'+this.props.name+'.png'}\n          //src={'./img/TASK_J2_03_prompt_1.png'}\n        ></img>\n      </div>\n    );\n  }\n}\n\n\n\n/* * * * * * * * * * * * * * * *\n * BoxController and children  *\n * * * * * * * * * * * * * * * */\n\nclass BoxController extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      theme: 'light'\n    };\n  }\n  static getDerivedStateFromProps(props, state) {\n    return {\n      theme: props.theme\n    };\n  }\n  setTheme = () => {\n    this.setState({ theme: this.state.theme === 'light' ? 'dark' : 'light' });\n  }\n  render() {\n    return(\n      <div className=\"box-controller\">\n        <div className=\"box-bar\">\n          <ProgressBar\n            voiceInput={this.state.voiceInput}\n            elapsedTime={this.props.elapsedTime}\n            maxTimeout={this.props.maxTimeout}\n          />\n          <div className={\"bar bar-base theme-\"+this.state.theme}\n          onClick={this.setTheme}></div>\n        </div>\n        <div className=\"box-buttons\">\n          <ButtonSmall\n            name=\"btnRewind\"\n            alignRight={false}\n            theme={this.state.theme}\n          />\n          <ButtonSmall name=\"btnSkip\" alignRight={false} theme={this.state.theme} />\n          <ButtonSmall name=\"btnExit\" alignRight={true} theme={this.state.theme} />\n        </div>\n      </div>\n    );\n  }\n}\nclass ProgressBar extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      voiceInput: 0\n    }\n  }\n  static getDerivedStateFromProps(props, state) {\n    return {\n      voiceInput: props.voiceInput,\n      elapsedTime: props.elapsedTime,\n    };\n  }\n  getWidth = () => {\n    let limit = this.props.maxTimeout;\n    let percentage = (this.state.elapsedTime / limit) * 100 + '%';\n    return percentage;\n  }\n  render() {\n    return (\n      <div\n        className={\"bar bar-progress\"}\n        style={{width: this.getWidth()}}\n      ></div>\n    );\n  }\n}\nclass ButtonSmall extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      theme: 'light',\n      clicked: false\n    }\n  }\n  static getDerivedStateFromProps(props, state) {\n    return {\n      theme: props.theme,\n      clicked: props.clicked\n    };\n  }\n  render() {\n    return (\n      <button\n        id={this.props.name}\n        className={\n          \"button-small theme-\"+\n          this.state.theme+\n          (this.props.alignRight ? ' align-right' : '')\n        }\n      >\n      </button>\n    );\n  }\n}\n\n\nfunction App() {\n  initData();\n  const element =\n    <Baseplate\n      name={currentData.name}\n      message={currentData.message}\n      displayMessage={currentData.displayMessage}\n      displayOnly={currentData.displayOnly}\n      hasImage={currentData.hasImage}\n      epd={currentData.epd}\n      answerEntity={currentData.answerEntity}\n      maxTimeout={currentData.maxTimeout}\n    />;\n  return(element);\n}\nexport default App;\n"]},"metadata":{},"sourceType":"module"}